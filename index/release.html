<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<link rel="stylesheet" type="text/css" href="../css/init.css" />
<link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_658342_4rtajfzq26e.css" />
<link rel="stylesheet" type="text/css" href="../css/weui.css" />
<link rel="stylesheet" type="text/css" href="../css/myweui.css" />
<link rel="stylesheet" type="text/css" href="../css/index/release.css" />
<script src="../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/base.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/citypicker.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/weui.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/myweui.js" type="text/javascript" charset="utf-8"></script>
<title>发布需求</title>
</head>

<body>
	<header class="mui_bar">
		<i class="iconfont icon-fanhui"></i>
		<h1 class="mui_title">发布需求</h1>
	</header>
	<div class="contaienr">
		<p class="item_tit">—— 填写房屋信息 ——</p>
		<div class="register_item">
			<p class="register_tit">省 市 区<span> </span></p>
			<input type="text" data-toggle="city-picker" id="city" value="" class="register_input qiu_all" placeholder="请填写" />
			<img src="../images/c01@2x.png" class="jiantou" />
		</div>
		<div class="register_item">
			<p class="register_tit">小 区<span> </span></p>
			<input type="text" name="" id="quarters" value="" class="register_input qiu_all" placeholder="请填写" />
		</div>
		<div class="register_item now_layer">
			<p class="register_tit">具体房号<span> </span></p>
			<input type="text" name="" id="" value="" class="size room" placeholder="" />
			<p class="unit hous_home1"><span>栋</span><img src="../images/down@2x.png" class="down_jiantou" /></p>
			<input type="text" name="" id="" value="" class="size room" placeholder="" />
			<p class="unit hous_home2"><span>栋</span><img src="../images/down@2x.png" class="down_jiantou" /></p>
			<input type="text" name="" id="" value="" class="size_num room" placeholder="" style="margin-left: 0.3;" />
			<p class="unit ">室</p>
		</div>
		<div class="register_item qu_tit">
			<p class="register_tit">所在楼层<span> </span></p>
			<input type="text" name="" id="floor" value="" class="xiaoqu floor" placeholder="填写" />
			<span>楼</span>
			<div class="lou_sub">
				共 <input type="text" name="" id="" value="" class="louceng floor" />楼
			</div>
		</div>
		<div class="register_item now_layer">
			<p class="register_tit">户型<span> </span></p>
			<input type="text" name="" id="" value="" class="size_num house_type" placeholder="" style="margin-left: 0.3;" />
			<p class="unit">室</p>
			<input type="text" name="" id="" value="" class="size_num house_type" placeholder="" style="margin-left: 0.3;" />
			<p class="unit">厅</p>
			<input type="text" name="" id="" value="" class="size_num house_type" placeholder="" style="margin-left: 0.3;" />
			<p class="unit">卫</p>
		</div>
		<div class="register_item">
			<p class="register_tit">装 修<span> </span></p>
			<span class="house_style renovation">毛坯</span>
			<span class="house_style renovation">简装</span>
			<span class="house_style house_style_active renovation">精装</span>
		</div>
		<div class="register_item qu_tit">
			<p class="register_tit">建筑面积<span> </span></p>
			<input type="text" name="" id="area" value="" class="area qiu_all" placeholder="填写" />
			<span>平方米</span>
		</div>
		<!--—— 填写购房人信息 ——-->
		<p class="item_tit">—— 填写购房人信息 ——</p>
		<div class="register_item qu_tit">
			<p style="margin-right: 0.4rem; width: 1.6rem;">是否首套房<span> </span></p>
			<input type="radio" name="radio1" id="" value="1" class="choose_item is_first" checked="checked"/>
			<span class="house_num" style="width: 1.6rem;">首套房</span>
			<input type="radio" name="radio1" id="" value="2" class="choose_item is_first" />
			<span class="house_num">两套及以上</span>
		</div>
		<div class="register_item qu_tit">
			<p style="margin-right: 0.4rem; width: 1.6rem;">是否贷款<span> </span></p>
			<input type="radio" name="radio2" id="" value="2" class="choose_item loan" checked="checked"/>
			<span class="house_num" style="width: 1.6rem;">全款</span>
			<input type="radio" name="radio2" id="" value="1" class="choose_item loan" />
			<span class="house_num">贷款</span>
		</div>
		<div class="register_item qu_tit">
			<p style="margin-right: 0.4rem;">是否要求包干价<span> </span></p>
			<input type="radio" name="radio3" id="" value="1" class="choose_item contract" checked="checked"/>
			<span class="house_num">是</span>
			<input type="radio" name="radio3" id="" value="2" class="choose_item contract" style="margin-left: 0.6rem;" />
			<span class="house_num">否</span>
		</div>
		<p class="what_money">什么是包干价？</p>
		<div class="what_details">
			<p>其实包干的意思类似于承包，都是两主体间对某事物的委托与包揽。但二者有区别，承包的利益分配和成本分担方法多样，也较为复杂，一般由当事双方约定或法定，一般按比例或项目分配。</p>
			<p>而包干则是预期额定的，即在建立包干关系时，由双方约定，在工作结束后，由承包人向发包人交付定额的利益，注意：是定额的。</p>
			<p>无论事后承包人盈亏与否，都应如约交付利益。人当时所说的顺口溜一样：“交足国家的，留够集体的，剩下都是自己的”，至于利润如何甚至盈亏与否，就看工作结果了。</p>
		</div>
		<div class="register_item qu_tit">
			<p style="margin-right: 0.4rem; width: 1.6rem;">报价时间<span> </span></p>
			<input type="radio" name="radio4" id="" value="1" class="choose_item quotation_time" checked="checked"/>
			<span class="house_num" style="width: 1.6rem;">1天</span>
			<input type="radio" name="radio4" id="" value="2" class="choose_item quotation_time" />
			<span class="house_num">2天</span>
		</div>
		<div class="register_item">
			<p class="register_tit">联 系 人<span> </span></p>
			<input type="text" name="" id="name" value="" class="register_input qiu_all" placeholder="请填写" />
		</div>
		<div class="register_item">
			<p class="register_tit">联系电话<span> </span></p>
			<input type="text" name="" id="tel" value="" class="register_input qiu_all" placeholder="请填写" />
		</div>
		<div class="register_item">
			<p class="register_tit">验 证 码<span> </span></p>
			<input type="text" name="" id="code" value="" class="register_input qiu_all" placeholder="请填写" />
			<input type="button" class="get_num" style="background: none; border: none; height: 0.88rem;" value="获取验证码">
		</div>
		<div class="remark">
			<p class="remark_tit">备注</p>
			<textarea name="" rows="" cols="" id="else" class="remark_text"></textarea>
		</div>
		<!--—— 提交诚意金并完成 ——-->
		<p class="item_tit">—— 提交诚意金并完成 ——</p>
		<div class="pay_money">
			<p>诚意金额：<span>1000</span> 元 </p>
		</div>
		<div class="answer_wrap">
			<span class="question" style="margin-bottom: 0.25rem;">问：</span>
			<span class="question_tit">为什么要缴纳诚意金?</span>
		</div>
		<div class="answer_wrap">
			<p class="answer_tit">答：</p>
			<span class="answer">天津卖房网 真实二手房产买卖信息,实时更新二手房交易资讯,就在比房价线上线下安心服务,简化选房流程,「链家」让房屋交易不再难。</span>
		</div>
		<div class="answer_wrap" style="margin-top: 0.56rem;">
			<span class="question" style="margin-bottom: 0.25rem;">问：</span>
			<span class="question_tit">为什么要缴纳诚意金?</span>
		</div>
		<div class="answer_wrap">
			<p class="answer_tit">答：</p>
			<span class="answer">天津卖房网 真实二手房产买卖信息,实时更新二手房交易资讯,就在比房价线上线下安心服务,简化选房流程,「链家」让房屋交易不再难。</span>
		</div>
		<div class="need_btn">
			确认缴纳诚意金
		</div>

		<!-- begin: 弹窗 -->
		<div class="popup"></div>
	</div>

<script type="text/javascript">
	var city,quarters,room,floor,house_type,renovation;
	var area,is_first,loan,contract,quotation_time,name,tel,code,else_s;
	var myreg=/^[1][3,4,5,7,8][0-9]{9}$/;
	var countdown = 60;
	var obj = $('.get_num');
	$(document).ready(function() {
		var what = true;
		$('.what_money').click(function() {
			if(what) {
				$('.what_details').show()
				what = false
			} else {
				$('.what_details').hide()
				what = true;
			}
		})

		//点击确认缴纳诚意金事件
		$('.need_btn').click(function(event) {
			if($('#city').val() == ''){
				popup('省市区不能为空');
				return false;
			}else if($('#quarters').val() == ''){
				popup('小区不能为空');
				return false;
			}else if($('#area').val() == ''){
				popup('建筑面积不能为空');
				return false;
			}else if($('#name').val() == ''){
				popup('联系人不能为空');
				return false;
			}else if($('#tel').val() == ''){
				popup('联系电话不能为空');
				return false;
			}else if(!myreg.test($('#tel').val())){
				popup('手机号码格式不正确');
				return false;
			}else if($('#code').val() == ''){
				popup('验证码不能为空');
				return false;
			}else{
				send();
			}	
		});
	})
	//发布需求数据接口
	function send(){
		//具体房号
		let room_length = $('.room').length;
		var room = '';
		room = $('.room').eq(0).val() + $('.hous_home1 span').text() + $('.room').eq(1).val() + $('.hous_home2 span').text() + $('.room').eq(2).val() + '室'
		console.log(room);

		//所在楼层
		let floor_length = $('.floor').length;
		var floor = '';
		floor = $('.floor').eq(0).val() + '楼' + '共' + $('.floor').eq(1).val() + '楼'
		console.log(floor);

		//户型
		let house_type_length = $('.house_type').length;
		var house_type = '';
		// for(let i = 0; i < house_type_length; i++) {
		// 	if($('.house_type').eq(i).val() != '') {
		// 		house_type += $('.house_type').eq(i).val() + '-'
		// 	}
		// }
		house_type = $('.house_type').eq(0).val() + '室' + $('.house_type').eq(1).val() + '厅' + $('.house_type').eq(2).val() + '卫'
		console.log(house_type);
		city = $('#city').val();
		quarters = $('#quarters').val();
		area = $('#area').val();
		name = $('#name').val();
		code = $('#code').val();
		else_s = $('#else').val();
		tel = $('#tel').val();

		renovation =  $('.house_style_active').html();

		is_first = $('input:radio[name="radio1"]:checked').val();
		loan = $('input:radio[name="radio2"]:checked').val();
		contract = $('input:radio[name="radio3"]:checked').val();
		quotation_time = $('input:radio[name="radio4"]:checked').val();
		var money = $('.pay_money span').html();

		$.ajax({
			url: baseUrl + 'UserNeed/send',
			type: 'POST',
			dataType: 'json',
			data: {
				city: city,
				quarters: quarters,
				room: room,
				floor: floor,
				renovation: renovation,
				house_type: house_type,
				area: area,
				is_first: is_first,
				loan: loan,
				contract: contract,
				quotation_time: quotation_time,
				name: name,
				code: code,
				else: else_s,
				tel: tel,
				token: localStorage.getItem('token'),
			},
			success:function(res){
				console.log(res);
				var code = res.code;
				var message = res.message;
				//存储
				userNeed = res.data.userNeed_id;
				localStorage.setItem('userNeed',userNeed);
				if(code == 1){
					popup('发布成功');
					setTimeout(function(){
						window.location.href='../index/pay_style.html'
					},1600)
				}else{
					popup(message);
				}
			}
		})
	}

	//获取当前时间
	function myDatet(){
		var myDate = new Date();
		//获取当年
		var year = myDate.getFullYear();
		//获取当月
		var month = myDate.getMonth()+1;
		//获取当日
		var date = myDate.getDate();
		var hous = myDate.getHours();
		var minutes = myDate.getMinutes();
		var now = year+'-'+(month)+"-"+(date)+" "+(hous)+':'+(minutes);
		console.log(now);
	}

	//点击获取验证码
    $('.get_num').click(function() {
        if($('#tel').val() == ''){
            popup('手机号码不能为空');
            return false;
        }else if(!myreg.test($('#tel').val())){
            popup('手机号码格式不正确');
            return false;
        }else {
            getSmsResult();
        }
    });

	//验证码倒计时60秒
	function settime(obj){
		if(countdown == 0){
			obj.attr('disabled', false);
			obj.val( '获取验证码');
			countdown = 60;
			return;
		}else{
			obj.attr('disabled', true);
			obj.val(countdown + '秒后再获取');
			countdown --;
		}
		setTimeout(function(){
			settime(obj);
		},1000)
	}

	//验证码接口
	function getSmsResult(){
		tel = $('#tel').val();
		var	obj = $('.get_num');
		$.ajax({
			url: baseUrl + 'User/getSmsResult',
			type: 'POST',
			dataType: 'json',
			data: {
				tel: tel,
				genre: 1,
				connect: 1,
			},
			success:function(res){
				console.log(res);
				settime(obj);
			}
		})
	}

	//户型切换
	var $rank_box = $('.register_item .house_style');
	$rank_box.click(function(){
		$(this).addClass('house_style_active').siblings().removeClass('house_style_active');
	});

	//具体房号
	$('.hous_home1').on('click', function () {
        weui.picker([{
            label: '栋',
            value: 0
        }, {
            label: '座',
            value: 1
        }, {
            label: '号',
            value: 2
        }, {
            label: '号楼',
            value: 3
        }, {
            label: '幢',
            value: 4
        }, {
            label: '区',
            value: 5
        },{
            label: '单元',
            value: 5
        },], {
            onChange: function (result) {
				 console.log(result);
            },
            onConfirm: function (result) {
            	$('.hous_home1 span').html(result[0].label)
            }
        });
    });
    $('.hous_home2').on('click', function () {
        weui.picker([{
            label: '栋',
            value: 0
        }, {
            label: '座',
            value: 1
        }, {
            label: '号',
            value: 2
        }, {
            label: '号楼',
            value: 3
        }, {
            label: '幢',
            value: 4
        }, {
            label: '区',
            value: 5
        },{
            label: '单元',
            value: 5
        },], {
            onChange: function (result) {
				 console.log(result);
            },
            onConfirm: function (result) {
            	$('.hous_home2 span').text(result[0].label)

            }
        });
    });

	//省市区关联
	$('#city').on('click ',function(){
		weui.picker(rawCitiesData, {
		    onConfirm: function (result) {
		      $('#city').val(result[0].label + '-' + result[1].label + '-' + result[2].label);
		    }
		});		
	})
	// function getInfo(){

	// }
	// if(id){
	// 	getInfo()
	// }
</script>
</body>
</html>